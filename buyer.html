<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Buyer calendar</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="assets/css/normalize.css">
        <link rel="stylesheet" href="assets/css/bootstrap-theme.min.css">
        <link rel="stylesheet" href="assets/css/bootstrap.min.css">
        <link rel="stylesheet" href="assets/css/gumcal.css">
        <link rel="stylesheet" href="assets/css/jquery-ui.min.css">
        <link rel="stylesheet" href="assets/css/jquery-ui.structure.min.css">
        <link rel="stylesheet" href="assets/css/jquery-ui.theme.min.css">
    </head>
    <body>
		<section id="calendar"></section><!-- cal view el -->
        
<script id="calview-template" type="text/x-handlebars-template">
    <h2>Appointments calendar<br>
        {{startDate}} - {{endDate}} 
    </h2>
    {{#ifCondition context 'seller'}}
        <div data-view="dashboard" class="panel panel-default"></div>
    {{/ifCondition}}     
    <ul>
        <li data-cal-tab="day">Day</li>
        <li data-cal-tab="month">Month</li>
    </ul>
    <div data-view="month"></div>
    <div data-view="day"></div>
</script>   

<script id="dashboardview-template" type="text/x-handlebars-template">
    <div class="panel-heading">
        <h2 class="h4">Calendar dashboard</h2>
    </div>
    <div class="panel-body">
        <strong>Location{{#ifCondition locationPrivate true}} - private{{/ifCondition}}:</strong>
        <span>
            {{location}}
        </span>
        <br>
        <strong>Autoconfirm 
            {{#ifCondition autoConfirm true}}
            on:</strong> 
            <span>Appointments will be automcatically confirmed via email when a booking is made
                {{else}}
                off: </strong>
                Appointments must be confirmed by the ad poster</span>
            {{/ifCondition}} 
            </div>    
            <ul class="list-group">
                <li class="list-group-item">
                    Available slots <span class="badge badge-success">{{slotCount}}</span>
                </li>
                <li class="list-group-item">
                    Booked slots <span class="badge badge-primary">{{bookedCount}}</span>
                </li>
                {{#ifCondition autoConfirm false}}
                    <li class="list-group-item">
                        Awaiting confirmation <span class="badge badge-warning">{{tentativeCount}}</span>
                    </li>
                {{/ifCondition}}     
            </ul>
            <div class="panel-footer">
                <button type="button" class="btn btn-danger" data-cancel-all {{#ifCondition isEmpty true}}disabled{{/ifCondition}}>
                    Cancel all
                </button>
            </div>
        </div>
    </div>
</script>

<script id="monthview-template" type="text/x-handlebars-template">
    <h2>{{monthYear}}</h2>
    {{#ifCondition context 'seller'}}
        <p>Click on a day to create bookable slots</p>
    {{else}}
        <p>Click on a day to book an appointment</p>
    {{/ifCondition}}
    <ol class="cal-month clearfix">
        {{#each days}}
        <li data-cal-day="{{@index}}">
            {{this}}
                <span class="badge badge-success">{{../availableCount}}</span>
            {{#ifCondition ../context 'seller'}}    
                <span class="badge badge-info">{{../../bookedCount}}</span>
                <span class="badge badge-warning">{{../../tentativeCount}}</span>
            {{/ifCondition}}    
           
        </li>
        {{/each}}
    </ol>
</script>

<script id="dayview-template" type="text/x-handlebars-template">
    <h2>{{prettyDate}}</h2>
    {{#ifCondition context 'seller'}}
        <p>Click times to create bookable slots</p>
    {{else}}
        <p>Click on a slot to book an appointment</p>
    {{/ifCondition}}
    <ul>
        <li data-prev-day>Prev</li>
        <li data-next-day>Next</li>
    </ul>
    <ol class="cal-day {{context}}">
        {{#each times}}
        <li data-cal-slot="{{@index}}" data-cal-datetime="{{this.[0]}}">
            {{this.[1]}}
        </li>
        {{/each}}
    </ol>
</script>

<script id="slotview-template" type="text/x-handlebars-template">
    <strong>{{prettyTime}}</strong>
    {{#ifCondition context 'seller'}}
        - <strong  >{{status}}</strong>
        <br>
        {{#ifCondition status 'available'}}
            <span data-delete-slot>Delete</span>
            <span data-book-slot>Book</span>
        {{else}}
            <span><strong>Name:</strong> {{name}}</span>
            <span data-view-slot>View</span>
        {{/ifCondition}} 
    {{else}} 
        {{#ifCondition context 'buyer'}}
            {{#ifCondition status 'available'}}
                <span data-book-slot>Book</span>
            {{/ifCondition}}    
        {{/ifCondition}} 
    {{/ifCondition}} 
</script>

<script id="bookingview-template" type="text/x-handlebars-template">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">Book appointment - {{prettyDate}}: {{prettyTime}}</h4>
            </div>
            <div class="modal-body">
                <form>
                    <label for="name-{{adId}}">Name:</label>
                    <input type="text" id="name-{{adId}}">

                    <label for="email-{{adId}}">Email:</label>
                    <input type="email" id="email-{{adId}}">

                    <label for="phone-{{adId}}">Phone:</label>
                    <input type="tel" id="phone-{{adId}}">

                    {{#ifCondition msgRequired true}}
                        <label for="msg-{{adId}}">{{msgSubject}}:</label>
                        <textarea id="msg-{{adId}}"></textarea>
                    {{/ifCondition}} 

                    {{#ifCondition context 'buyer'}}
                        {{#ifCondition autoConfirm true}}
                            <p><strong>Please note:</strong> This appointment will be <strong>automatically confirmed</strong> when you complete this booking</p>
                        {{else}}   
                            <p><strong>Please note:</strong> This appointment must be confirmed by the ad poster before this booking is final. 
                            The ad poster will be notified of your booking and you will receive an email confirmation from the ad poster shortly.
                            </p>
                        {{/ifCondition}} 
                    {{/ifCondition}} 

                    {{#ifCondition context 'seller'}}
                        <input type="submit" value="Set up appointment" class="btn btn-primary" data-book-submit />
                    {{else}}       
                        <input type="submit" value="Book appointment" class="btn btn-primary" data-book-submit />
                    {{/ifCondition}} 

                    <div class="success-notification confirm hidden alert alert-info">
                        {{#ifCondition context 'seller'}}
                            <div class="" role="alert">  
                                <strong>Booking confirmed!</strong>
                                    Thanks, this booking has now been confirmed and <strong>{{name}}</strong> 
                                    has been notified by email at <strong>{{email}}</strong>
                            </div>
                        {{/ifCondition}} 
                        {{#ifCondition context 'buyer'}}
                            {{#ifCondition autoConfirm true}}
                                <p>Thanks, your booking is confirmed and the ad poster has been notified</p>
                            {{else}}   
                                <p>
                                    Thanks, the ad poster has been notified of your booking and will be in touch shortly
                                </p>
                            {{/ifCondition}} 
                        {{/ifCondition}} 
                    </div>
                </form>
            </div>
        </div>
    </div>
</script>

<script id="detailview-template" type="text/x-handlebars-template">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">Booking details</h4>
            </div>
        <div class="modal-body">
            <ul>
                <li><strong>Date:</strong> {{prettyDate}}</li>
                <li><strong>Time:</strong> {{prettyTime}}</li>
                <li><strong>Location:</strong> {{location}}</li>
                <li><strong>Name:</strong> {{name}}</li>
                <li><strong>Phone:</strong> {{phone}}</li>
                <li><strong>Email:</strong> {{email}}</li>
                <li><strong>Message subject:</strong> {{msgSubject}}</li>
                <li><strong>Message:</strong> {{message}}</li>
                <li><strong>Booking status:</strong> {{status}}</li>
            </ul>
            <div class="success-notification cancel hidden alert alert-danger" role="alert">
                <strong>Booking cancelled!</strong>
                Thanks, this booking has now been cancelled and <strong>{{name}}</strong> has been notified by email at <strong>{{email}}</strong>
            </div>  
            <div class="success-notification confirm hidden alert alert-info" role="alert">  
                <strong>Booking confirmed!</strong>
                Thanks, this booking has now been confirmed and <strong>{{name}}</strong> has been notified by email at <strong>{{email}}</strong>
            </div>   
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            {{#ifCondition status 'booked'}}
                <button type="button" class="btn btn-danger" data-cancel-slot>Cancel booking</button>
            {{/ifCondition}}   
            {{#ifCondition status 'tentative'}}
                <button type="button" class="btn btn-primary" data-confirm-slot>Confirm booking</button>
                <button type="button" class="btn btn-danger" data-cancel-slot>Cancel booking</button>
            {{/ifCondition}}  
        </div>
    </div>
</script>

<script id="cancelallview-template" type="text/x-handlebars-template">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">Cancel all</h4>
            </div>
            <div class="modal-body">
                <p>You have <strong>{{bookedCount}}</strong> booked appointments, <strong>{{tentativeCount}}</strong> appointments awaiting confirmation,
                and <strong>{{slotCount}}</strong> available slots in your calendar.</p>
                <h3 class="h4">What would you like to do?</h2>
                <ul>
                    <li>
                        <p>Cancel all booked and pending appointments and <strong>close</strong> all available slots in your calendar</p>
                        <button type="button" class="btn btn-danger" data-cancel-all-close><strong>Close</strong> all slots</button>
                    </li>
                    <li>
                        <p>Cancel all booked and pending appointments and <strong>keep open</strong> all available slots in your calendar</p>
                        <button type="button" class="btn btn-danger" data-cancel-all-keep{{#ifCondition activeSlots false}} disabled{{/ifCondition}}>
                            Cancel and <strong>keep</strong> slots
                        </button>
                    </li>     
                </ul>
                <div class="success-notification cancel-all-keep hidden alert alert-danger" role="alert">  
                    <strong>All apointments cancelled!</strong>
                    Thanks, you have cancelled <strong>{{cancelledSlotCount}}</strong> appointments. <br>
                    You now have <strong>{{updatedSlotCount}}</strong> available slots in your calendar.
                </div>  
                <div class="success-notification cancel-all-close hidden alert alert-danger" role="alert">  
                    <strong>All slots closed!</strong>
                    Thanks, you have cancelled <strong>{{cancelledSlotCount}}</strong> appointments. <br>
                    You now have <strong>0</strong> available slots in your calendar.
                </div>   
            </div>
            <div class="modal-footer">
                 <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>    
</script>  

		<script src="js/lib/jquery-1.11.1.js"></script>
        <script src="js/lib/jquery-ui.min.js"></script>
        <script src="js/lib/bootstrap.min.js"></script>
        <script src="js/lib/handlebars-v1.3.0.js"></script>
        <script src="js/lib/handlebars-helpers.js"></script>
		<script src="js/lib/underscore.js"></script>
        <script src="js/lib/backbone.js"></script>
        <script src="js/lib/backbone.localStorage.js"></script>
        <script src="js/models/slot.js"></script>
		<script src="js/collections/slots.js"></script>
		<script src="js/views/cal-view.js"></script>
        <script src="js/views/dashboard-view.js"></script>
        <script src="js/views/month-view.js"></script>
        <script src="js/views/day-view.js"></script>
		<script src="js/views/booking-view.js"></script>
        <script src="js/views/slot-view.js"></script>
        <script src="js/views/detail-view.js"></script>
        <script src="js/views/cancel-all-view.js"></script>
		<script src="js/buyer/app-buyer.js"></script>

        <script>
            gumCal.config = {
                context: "buyer",
                adId: "123456789",
                slotDuration: 15,
                startDate: '2014-07-01',
                endDate: '2014-07-31',
                location: 'Whittakers',
                locationPrivate: false,
                msgRequired: false,
                msgSubject: 'Why are you awesome?',
                autoConfirm: false
            };

            //  gumCal.config = {
            //     context: "buyer",
            //     adId: "998989787",
            //     slotDuration: 15,
            //     startDate: '2014-07-01',
            //     endDate: '2014-07-31',
            //     location: 'Whittakers',
            //     locationPrivate: false,
            //     msgRequired: true,
            //     msgSubject: 'Why are you awesome?',
            //     autoConfirm: false
            // };
        </script>
    </body>
</html>
